<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>退休計劃問答</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333;
        }
        .question {
            margin-bottom: 20px;
        }
        .question h3 {
            margin-bottom: 10px;
            color: #555;
        }
        .question div, .question label {
            margin-bottom: 5px;
            display: block;
            color: #777;
        }
        .submit-button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            cursor: pointer;
            text-align: center;
            border-radius: 5px;
            font-size: 16px;
        }
        .submit-button:hover {
            background-color: #0056b3;
        }
        .result {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .result h3 {
            color: #333;
        }
        .result p {
            color: #555;
        }
        .formula {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-family: monospace;
        }
        .icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin-right: 5px;
        }
        canvas {
            max-width: 100%;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>退休計劃問答</h2>

        <form id="retirementForm">
            <div class="question">
                <h3>個人資料</h3>
                <label for="currentAge">現今年齡:</label>
                <input type="number" id="currentAge" name="currentAge" min="0" required>
            </div>

            <div class="question">
                <h3>退休計劃</h3>
                <label for="retirementAge">預計退休年齡:</label>
                <input type="number" id="retirementAge" name="retirementAge" min="0" required>

                <label for="endOfLifeAge">預計壽命年齡:</label>
                <input type="number" id="endOfLifeAge" name="endOfLifeAge" min="0" required>
            </div>

            <div class="question">
                <h3>退休後開支</h3>
                <h4>A) 每年開支</h4>
                <label for="monthlyExpenses">每月生活費 (港幣 HKD):</label>
                <input type="number" id="monthlyExpenses" name="monthlyExpenses" min="0" required>

                <label for="annualTravelExpenses">每年旅行費用 (港幣 HKD):</label>
                <input type="number" id="annualTravelExpenses" name="annualTravelExpenses" min="0" required>

                <label for="annualChildExpenses">每年子女支出 (港幣 HKD):</label>
                <input type="number" id="annualChildExpenses" name="annualChildExpenses" min="0" required>

                <label for="childSupportYears">供養年期 (年):</label>
                <input type="number" id="childSupportYears" name="childSupportYears" min="0" required>
            </div>

            <div class="question">
                <h4>B) 大額開支</h4>
                <label for="medicalExpenses">醫療 (港幣 HKD):</label>
                <input type="number" id="medicalExpenses" name="medicalExpenses" min="0" required>

                <label for="educationFund">升學基金 (港幣 HKD):</label>
                <input type="number" id="educationFund" name="educationFund" min="0" required>

                <label for="otherExpenses">其他 (港幣 HKD):</label>
                <input type="number" id="otherExpenses" name="otherExpenses" min="0">
            </div>

            <div class="question">
                <h4>C) 年通脹率</h4>
                <label for="inflationRate">年通脹率 (%):</label>
                <input type="number" id="inflationRate" name="inflationRate" min="0" step="0.1" required>
            </div>

            <button type="button" class="submit-button" onclick="calculateRetirementPlan()">提交</button>
        </form>

        <div id="result" class="result">
            <h3>結果</h3>
            <p id="totalAmount"></p>
            <p id="monthlyPassiveIncome"></p>
            <h4>計算公式:</h4>
            <div class="formula" id="calculationSteps"></div>
            <canvas id="expenseChart"></canvas>
            <canvas id="incomeChart"></canvas>
        </div>
    </div>

    <script>
        function calculateRetirementPlan() {
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const retirementAge = parseInt(document.getElementById('retirementAge').value);
            const endOfLifeAge = parseInt(document.getElementById('endOfLifeAge').value);
            const monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value);
            const annualTravelExpenses = parseFloat(document.getElementById('annualTravelExpenses').value);
            const annualChildExpenses = parseFloat(document.getElementById('annualChildExpenses').value);
            const childSupportYears = parseInt(document.getElementById('childSupportYears').value);
            const medicalExpenses = parseFloat(document.getElementById('medicalExpenses').value);
            const educationFund = parseFloat(document.getElementById('educationFund').value);
            const otherExpenses = parseFloat(document.getElementById('otherExpenses').value) || 0;
            const inflationRate = parseFloat(document.getElementById('inflationRate').value) / 100;

            const retirementYears = endOfLifeAge - retirementAge;
            const annualLivingExpenses = monthlyExpenses * 12;
            const totalAnnualExpenses = annualLivingExpenses + annualTravelExpenses + (annualChildExpenses * Math.min(childSupportYears, retirementYears));

            let totalExpenses = 0;
            for (let i = 0; i < retirementYears; i++) {
                totalExpenses += totalAnnualExpenses * Math.pow(1 + inflationRate, i);
            }

            totalExpenses += medicalExpenses + educationFund + otherExpenses;

            const totalAmount = document.getElementById('totalAmount');
            const monthlyPassiveIncome = document.getElementById('monthlyPassiveIncome');
            const calculationStepsElement = document.getElementById('calculationSteps');

            totalAmount.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/calculate.png" class="icon">退休計劃的總金額 (由退休後至壽命終止): ${totalExpenses.toFixed(2)} 港幣`;
            monthlyPassiveIncome.innerHTML = `<img src="https://img.icons8.com/ios-filled/50/000000/money-bag.png" class="icon">退休後估算每月需要的被動收入金額: ${(totalExpenses / (retirementYears * 12)).toFixed(2)} 港幣`;

            const formula1 = `每年開支的現值總和 * (1 + 年通脹率)^退休生活年期 + 醫療開支 + 升學基金 + 其他開支`;
            const formula2 = `總退休計劃金額 / (退休年數 * 12)`;

            const formulaDisplay = `
總退休計劃金額運算如下:
${formula1}

退休計劃的總金額 (由退休後至壽命終止): ${totalExpenses.toFixed(2)} 港幣

每月需要的被動收入金額運算如下:
${formula2}

退休後估算每月需要的被動收入金額: ${(totalExpenses / (retirementYears * 12)).toFixed(2)} 港幣
            `;

            calculationStepsElement.innerText = formulaDisplay;

            document.getElementById('result').style.display = 'block';

            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');

            new Chart(expenseCtx, {
                type: 'pie',
                data: {
                    labels: ['生活費', '旅行費用', '子女支出', '醫療', '升學基金', '其他'],
                    datasets: [{
                        data: [
                            totalAnnualExpenses * retirementYears,
                            annualTravelExpenses * retirementYears,
                            annualChildExpenses * Math.min(childSupportYears, retirementYears),
                            medicalExpenses,
                            educationFund,
                            otherExpenses
                        ],
                        backgroundColor: [
                            '#36a2eb',
                            '#ff6384',
                            '#ffcd56',
                            '#4bc0c0',
                            '#9966ff',
                            '#c9cbcf'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw.toFixed(2) + ' 港幣';
                                }
                            }
                        }
                    }
                }
            });

            new Chart(incomeCtx, {
                type: 'bar',
                data: {
                    labels: ['被動收入'],
                    datasets: [{
                        label: '每月需要的被動收入金額 (港幣)',
                        data: [(totalExpenses / (retirementYears * 12))],
                        backgroundColor: '#42a5f5'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.raw.toFixed(2) + ' 港幣';
                                }
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
